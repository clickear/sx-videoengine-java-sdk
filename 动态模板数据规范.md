### 动态模板

普通动态模板只支持图片素材的顺序替换.如需支持某张图片绑定附加的文字/图片素材, 请按照附加素材替换说明导出模板和提交数据


### 附加素材替换说明


+ 设计师按规则，标记需要绑定文字的图片素材和文字素材的 ui_key

    假如片头有一张图片素材需要关联一张文字素材，
    需要把图片素材的 ui_key 标记为 dimg1，把关联的文字素材标记为 dtext1.1  
    这样引擎会通过 dimg1 和 dtext1.1 关联替换  
    假如需要对应多张文字素材，可以依次设置文字素材的 ui_key 为 dtext1.2, dtext1.3

+ api 向引擎提交数据的时候，增加　subImgFiles 字段，用于提交关联的附加文字素材或者图片素材

    subImgFiles 是一个　json 数组，由以下 item 组成:

    ```json
    {
        "imgPath" : "https://ve-img-src.atvideo.cc/workspace/assets/2.jpeg",
        "dKeyPrefix" : "dtext",
        "dImgPaths" : [
            "https://ve-img-src.atvideo.cc/workspace/assets/235_41_text2.png",
            "https://ve-img-src.atvideo.cc/workspace/assets/235_41_text3.png"
        ]
    }

    ```
    
    + 字段含义

            imgPath    主图片的链接  
            dKeyPrefix 文字素材　ui_key 的开头字符  
            dImgPaths   附加的素材链接，用于依次替换　dKeyPrefix 开头的素材
    
    + 关联格式

            imgPath 的 ui_key 限制为 dimg 开头， 格式为 dimg#， # 代表整数序号，比如 dimg1, dimg2 

            dKeyPrefix 的 ui_key 格式为 dimg#.#， 第 1 个 # 对应 dimg 的序号， 第 2 个 # 对应附加素材的序号

            比如 dtext1.1 为 dimg1 第1个附加素材，dtext1.2 则对应 dimg1 的第2个附加素材

    + 示例数据说明

            以上数据示例有两个附加素材链接，假如 imgPath 对应的 ui_key 是 dimg1, 则通过 dtext1 关联的附加素材, 会被依次替换：

            dtext1.1 会被替换成 dImgPaths 中的第一长图片, dtext1.2 会被替换成 dImgPaths 的第二张图片，以此类推

    
    + 如需替换头像，可以通过自定义附加素材的 dKeyPrefix 

        ```json 
        {
            "imgPath" : "", // 如没有关联父素材,设置为空字符串
            "dKeyPrefix" : "dheadimg", // 精确匹配 dKeyPrefix 替换
            "dImgPaths" : ["https://ve-img-src.atvideo.cc/workspace/assets/235_41_text9.png"]
        }
        ```

    
    
+ 导出的　config.json 中的片段

    ```json
    {
        "entrance": {
            "name": "comp8",
            "duration": 85,
            "size": [
                544,
                960
            ],
            "bg": "#ffffffff",
            "layers": [
                {
                    "ui_key": "dimg1",
                    "ui_extra": "",
                    "source": "assetkey25",
                    "type": 4097,
                    "blend": 0,
                    "matte": 0,
                    "parent": -1,
                    "resample": 0,
                    "enabled": true,
                    "range": [
                        0,
                        0,
                        85
                    ],
                    "mask": [],
                    "effects": [],
                    "transform": "data0.json"
                },
                {
                    "ui_key": "dtext1.1",
                    "ui_extra": "",
                    "source": "assetkey23",
                    "type": 129,
                    "blend": 0,
                    "matte": 0,
                    "parent": 0,
                    "resample": 0,
                    "enabled": true,
                    "range": [
                        0,
                        0,
                        85
                    ],
                    "mask": [],
                    "effects": [],
                    "transform": {
                        "p": [
                            260.933,
                            159.0
                        ],
                        "a": [
                            116.21,
                            123.821
                        ],
                        "s": [
                            1.0,
                            1.0
                        ],
                        "t": 1.0,
                        "r": 0.0
                    }
                }
            ]
        }
    }
    ```
    
+ 动态模板 附加数据和头像测试数据    
```json

{
	"createdAt":1554726135000,
	"imgUrls":"https://ve-img-src.atvideo.cc/workspace/assets/1.jpeg,https://ve-img-src.atvideo.cc/workspace/assets/2.jpeg,https://ve-img-src.atvideo.cc/workspace/assets/3.jpeg,https://ve-img-src.atvideo.cc/workspace/assets/4.jpeg,https://ve-img-src.atvideo.cc/workspace/assets/5.jpeg",
	"subImgFiles": [
		{
			"imgPath" : "https://ve-img-src.atvideo.cc/workspace/assets/1.jpeg",
			"dKeyPrefix" : "dtext",
			"dImgPaths" : ["https://ve-img-src.atvideo.cc/workspace/assets/235_41_text1.png"]
		},
		{
			"imgPath" : "https://ve-img-src.atvideo.cc/workspace/assets/2.jpeg",
			"dKeyPrefix" : "dtext",
			"dImgPaths" : ["https://ve-img-src.atvideo.cc/workspace/assets/235_41_text2.png", "https://ve-img-src.atvideo.cc/workspace/assets/235_41_text3.png"]
		},
		{
			"imgPath" : "https://ve-img-src.atvideo.cc/workspace/assets/3.jpeg",
			"dKeyPrefix" : "dtext",
			"dImgPaths" : ["https://ve-img-src.atvideo.cc/workspace/assets/235_41_text4.png"]
		},
		{
			"imgPath" : "https://ve-img-src.atvideo.cc/workspace/assets/4.jpeg",
			"dKeyPrefix" : "dtext",
			"dImgPaths" : ["https://ve-img-src.atvideo.cc/workspace/assets/235_41_text8.png"]
		},
		{
			"imgPath" : "",
			"dKeyPrefix" : "dheadimg",
			"dImgPaths" : ["https://ve-img-src.atvideo.cc/workspace/assets/235_41_text9.png"]
		}
	],
	
	"recordId":99,
	"tplId":2001,
	"tplUrl":"http://static.atvideo.cc/dynamic_text1.zip",
	"tplVersion":1,
	"uploadKey":"dynamic_headimg.mp4",
	"musicUrl": "https://ve-v-src.atvideo.cc/music.mp3",
	"musicLoop": true
	
}


```

+ 动态模板附加素材－测试数据

```json

{
	"createdAt":1554726135000,
	"imgUrls":"https://ve-img-src.atvideo.cc/workspace/assets/1.jpeg,https://ve-img-src.atvideo.cc/workspace/assets/2.jpeg,https://ve-img-src.atvideo.cc/workspace/assets/3.jpeg,https://ve-img-src.atvideo.cc/workspace/assets/4.jpeg,https://ve-img-src.atvideo.cc/workspace/assets/5.jpeg",
	"subImgFiles": [
		{
			"imgPath" : "https://ve-img-src.atvideo.cc/workspace/assets/1.jpeg",
			"dKeyPrefix" : "dtext",
			"dImgPaths" : ["https://ve-img-src.atvideo.cc/workspace/assets/235_41_text1.png"]
		},
		{
			"imgPath" : "https://ve-img-src.atvideo.cc/workspace/assets/2.jpeg",
			"dKeyPrefix" : "dtext",
			"dImgPaths" : ["https://ve-img-src.atvideo.cc/workspace/assets/235_41_text2.png", "https://ve-img-src.atvideo.cc/workspace/assets/235_41_text3.png"]
		},
		{
			"imgPath" : "https://ve-img-src.atvideo.cc/workspace/assets/3.jpeg",
			"dKeyPrefix" : "dtext",
			"dImgPaths" : ["https://ve-img-src.atvideo.cc/workspace/assets/235_41_text4.png"]
		},
		{
			"imgPath" : "https://ve-img-src.atvideo.cc/workspace/assets/4.jpeg",
			"dKeyPrefix" : "dtext",
			"dImgPaths" : ["https://ve-img-src.atvideo.cc/workspace/assets/235_41_text8.png"]
		},
		{
			"imgPath" : "https://ve-img-src.atvideo.cc/workspace/assets/4.jpeg",
			"dKeyPrefix" : "dsubimg",
			"dImgPaths" : ["https://ve-img-src.atvideo.cc/workspace/assets/235_41_text9.png"]
		}
	],
	
	"recordId":99,
	"tplId":2000,
	"tplUrl":"http://static.atvideo.cc/dynamic_text.zip",
	"tplVersion":1,
	"uploadKey":"dynamic4.mp4",
	"musicUrl": "https://ve-v-src.atvideo.cc/music.mp3",
	"musicLoop": true
	
}

```    
    
    