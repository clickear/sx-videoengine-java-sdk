### 动态模板渲染文档

### 附加素材替换说明

+ 设计师按规则，标记需要绑定文字的图片素材和附加素材的 ui_key

    如有一张图片素材需要关联一张附加素材，
    需要设计师把图片素材的 ui_key 标记为 dimg1，再把关联的附加素材标记为 dtext1.1, 引擎会通过 dimg1 和 dtext1.1 关联替换  
    如需要对应多张文字素材，依次设置附加素材的 ui_key 为 dtext1.2, dtext1.3

+ 通过 VeProcessRenderTask.setDynamicSubFiles 设置附加素材数组

    参数为 json 数组:

    ```json
    [
        {
            "img_path" : "./workspace/assets/2.jpeg",
            "d_key_prefix" : "dtext",
            "d_img_path" : [
                "./workspace/assets/235_41_text2.png",
                "./workspace/assets/235_41_text3.png"
            ]
        }
    ]

    ```
    
    + 字段含义

            img_path      主替换图片的链接  
            d_key_prefix  附加素材　ui_key 的开头字符  
            d_img_paths   附加素材链接，用于依次替换　d_key_prefix 开头的素材
    
    + 关联格式

            img_path 对应素材的 ui_key 必须为 dimg 开头， 格式为 dimg#， # 代表整数序号，比如 dimg1, dimg2 

            d_key_prefix 的 ui_key 格式为 dimg#.#， 第 1 个 # 对应 dimg 的序号， 第 2 个 # 对应附加素材的序号

            比如 dtext1.1 为 dimg1 第1个附加素材，dtext1.2 则对应 dimg1 的第2个附加素材

    + 示例数据说明

            以上数据示例有两个附加素材链接，假如 img_path 对应的 ui_key 是 dimg1, 则通过 dtext1 关联的附加素材. 
            会被依次替换：dtext1.1 会被替换成 d_img_paths 中的第一长图片, dtext1.2 会被替换成 d_img_paths 的第二张图片，以此类推

    + 前缀查找替换数据格式
    
    ```json 
    [
        {
            "img_path" : "./workspace/assets/2.jpeg",  // 必须设置, 表示为前缀查找替换
            "d_key_prefix" : "dtext",                  // 按 img_path 关联的 dtext 前缀
            "d_img_paths" : [                          // 支持的附加图片数目请咨询对应模板设计师 
                "./workspace/assets/235_41_text2.png",
                "./workspace/assets/235_41_text3.png"
            ]
        }
    ]
    
    ```
    
    + 精确匹配替换格式
    
    ```json 
    [
        {
            "img_path" : "",                // 设置为空字符串, 表示替换动作为精确匹配 d_key_prefix
            "d_key_prefix" : "dheadimg",    // 精确匹配 dKeyPrefix 替换
            "d_img_paths" : [
                "./workspace/assets/235_41_text9.png"
             ]
        }
    ]
    ```
        
    + 同时设置多个附加素材数据
        
    ```json 
    [
        {
            "img_path" : "",                // 设置为空字符串, 表示替换动作为精确匹配 d_key_prefix
            "d_key_prefix" : "dheadimg",    // 精确匹配 dKeyPrefix 替换
            "d_img_paths" : [
                "./workspace/assets/235_41_text9.png"
             ]
        },
        {
            "img_path" : "./workspace/assets/2.jpeg",  // 必须设置, 表示为前缀查找替换
            "d_key_prefix" : "dtext",                  // 按 img_path 关联的 dtext 前缀
            "d_img_paths" : [                           // 支持的附加图片数目请咨询对应模板设计师 
                "./workspace/assets/235_41_text2.png",
                "./workspace/assets/235_41_text3.png"
            ]
        },
        {
            "img_path" : "./workspace/assets/3.jpeg",  // 必须设置, 表示为前缀查找替换
            "d_key_prefix" : "dtext",                  // 按 img_path 关联的 dtext 前缀
            "d_img_paths" : [                           // 支持的附加图片数目请咨询对应模板设计师 
                "./workspace/assets/235_41_text4.png",
            ]
        }
    ]
    ```


### 动态模板附加文字设置

动态模板支持附加文字的设置, 设计师需要按上文 "附加素材替换说明" 中的步骤编辑导出模板. 

文字绘制的效果由模板中的对应的文字配置信息决定, 引擎最终会调用 TextPainter 把文字转成图片参与渲染.

+ 注意事项:

    + 字体请参考 textpainter 文件夹中的说明文档
    + 不支持 emoji
    + 必须调用 VeProcessRenderTask.setAssetDir 设置文字图片的保存目录
    + 必须调用 VeProcessRenderTask.setTextPainterDir 设置文字绘制工具目录
    
+ 通过 VeProcessRenderTask.setDynamicSubTexts 设置附加文字素材数组

    参数为 json 数组:

    ```json
    [
        {
            "img_path" : "./workspace/assets/2.jpeg",
            "d_key_prefix" : "dtext",
            "d_texts" : [ // 会使用 TextPainter 绘制文字转成图片
                "标题",
                "昵称"
            ]
        }
    ]

    ```
    
    + 字段含义

            img_path      主替换图片的链接  
            d_key_prefix  附加素材　ui_key 的开头字符  
            d_texts       附加文字,会被转成文字图片,依次替换　d_key_prefix 开头的素材
    
    + 关联格式

            img_path 对应素材的 ui_key 必须为 dimg 开头， 格式为 dimg#， # 代表整数序号，比如 dimg1, dimg2 

            d_key_prefix 的 ui_key 格式为 dimg#.#， 第 1 个 # 对应 dimg 的序号， 第 2 个 # 对应附加素材的序号

            比如 dtext1.1 为 dimg1 第1个附加素材，dtext1.2 则对应 dimg1 的第2个附加素材

    + 前缀查找替换数据格式
    
    ```json 
    [
        {
            "img_path" : "./workspace/assets/2.jpeg",  // 必须设置, 表示为前缀查找替换
            "d_key_prefix" : "dtext",                  // 按 img_path 关联的 dtext 前缀
            "d_texts" : [                           // 支持的附加图片数目请咨询对应模板设计师 
                "hello world",
                "hello world"
            ]
        }
    ]
    
    ```
    
    + 精确匹配替换格式
    
    ```json 
    [
        {
            "img_path" : "",                // 设置为空字符串, 表示替换动作为精确匹配 d_key_prefix
            "d_key_prefix" : "nickname",    // 精确匹配 dKeyPrefix 替换
            "d_texts" : [
                "用户昵称"
             ]
        }
    ]
    ```
        
    + 同时设置多个附加素材数据
        
    ```json 
    [
        {
            "img_path" : "",                // 设置为空字符串, 表示替换动作为精确匹配 d_key_prefix
            "d_key_prefix" : "nickname",    // 精确匹配 dKeyPrefix 替换
            "d_texts" : [
                "用户昵称"
             ]
        },
        {
            "img_path" : "./workspace/assets/2.jpeg",  // 必须设置, 表示为前缀查找替换
            "d_key_prefix" : "dtext",                  // 按 img_path 关联的 dtext 前缀
            "d_texts" : [                           // 支持的附加图片数目请咨询对应模板设计师 
                "hello world",
                "hello ve text"
            ]
        },
        {
            "img_path" : "./workspace/assets/3.jpeg",  // 必须设置, 表示为前缀查找替换
            "d_key_prefix" : "dtext",                  // 按 img_path 关联的 dtext 前缀
            "d_texts" : [                           // 支持的附加图片数目请咨询对应模板设计师 
                "hello dtext",
            ]
        }
    ]
    ```

+ 测试程序

    com.seeshiontech.vesdk.DynamicTest.testDynamicText()